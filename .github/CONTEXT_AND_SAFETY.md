# Auto-Fix Agent: Context & Safety üîê

## üß† –ö–ê–ö –ê–ì–ï–ù–¢ –ü–û–ù–ò–ú–ê–ï–¢ –ö–û–ù–¢–ï–ö–°–¢?

### 1. **–ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–∫–∏ + –ö–æ–Ω—Ç–µ–∫—Å—Ç (–ù–µ –ø—Ä–æ—Å—Ç–æ —ç—Ö–æ!)**

–í–æ—Ç –ß–¢–û –≤–∏–¥–∏—Ç –∞–≥–µ–Ω—Ç:

```
–û–®–ò–ë–ö–ê (Error logs)
    ‚Üì
    –ö–û–ù–¢–ï–ö–°–¢:
    - –ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –∫–æ–º–º–∏—Ç–∞ (–ß—Ç–æ –¥–æ–±–∞–≤–∏–ª–∏ —Å–µ–≥–æ–¥–Ω—è?)
    - –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç–µ—Å—Ç—ã (–ß—Ç–æ —Ä–∞–Ω—é—à–µ —Ä–∞–±–æ—Ç–∞–ª–æ?)
    - Project config (–ö–∞–∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–∞?)
    - README (–ö–∞–∫–æ–≤—ã —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è –ø—Ä–æ–µ–∫—Ç–∞?)
    ‚Üì
–û–°–ú–´–°–õ–ï–ù–ù–û–ï –ü–û–ù–ò–ú–ê–ù–ò–ï
    ‚Üì
–ë–ï–ó–û–ü–ê–°–ù–´–ô –§–ò–ö—Å
```

### 2. **–°–∏—Å—Ç–µ–º–∞ –ö–æ–Ω—Ç–µ–∫—Å—Ç–∞ (4 —Å–ª–æ—è)**

#### –°–ª–æ–π 1: Project Context
```yaml
# –ê–≥–µ–Ω—Ç —á–∏—Ç–∞–µ—Ç projects/*/config.yaml
project:
  name: "youtube_horoscope"
  type: "content-generator"
  python_version: "3.11"
  
# –ü–æ–Ω–∏–º–∞–µ—Ç:
# - –û—Ç —ç—Ç–æ –Ω–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —ç—Ç–æ –∞–≥–µ–Ω—Ç
# - –ü–∏—Ç–æ–Ω 3.11 –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
# - –ù–µ –¥–µ–ª–∞—Ç—å Node.js —Ç—Ä—é–∫
```

#### –°–ª–æ–π 2: Recent Commits (–ò—Å—Ç–æ—Ä–∏—è)
```bash
# –í—Å—ë –≤ –æ–¥–Ω–æ–π –æ—à–∏–±–∫–µ?

$ git log --oneline -3

abc123d  Fix: Gemini TTS api_key parameter
         - Added api_key to all synthesize() calls
         - All tests pass
def456e  Refactor: TTS generator split into modules  
         - Split into core/generators/tts_generator.py
         - Breaking change: API now requires api_key
ghi789f  Add Gemini 2.5 TTS support
         - Switched from Edge-TTS
         - Uses GOOGLE_AI_API_KEY

# –ê–≥–µ–Ω—Ç –º—ã—Å–ª–∏—Ç:
# "–û! abc123d —É–∂–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞–ª–∏ —Ñ–∏–∫—Å–∏—Ç—å api_key
#  def456e - —ç—Ç–æ breaking change - –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –≤—Å—ë –æ–±–Ω–æ–≤–ª–µ–Ω–æ?
#  ghi789f - —ç—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞"
```

#### –°–ª–æ–π 3: Test History
```bash
# –ê–≥–µ–Ω—Ç –∑–Ω–∞–µ—Ç —á—Ç–æ —Ä–∞–Ω—å—à–µ —Ä–∞–±–æ—Ç–∞–ª–æ

Test Results (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∑–∞–ø—É—Å–∫–æ–≤):
‚úÖ Pass  - Refactor TTS
‚úÖ Pass  - Clean up unused imports
‚úÖ Pass  - Update requirements
‚ùå Fail  - Fix api_key
‚ùå Fail  - Add Gemini TTS

# –ê–≥–µ–Ω—Ç –º—ã—Å–ª–∏—Ç:
# "–ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ
#  –≠—Ç–æ –Ω–æ–≤–∞—è –æ—à–∏–±–∫–∞ –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
#  –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —è –ø–æ–Ω–∏–º–∞—é —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ"
```

#### –°–ª–æ–π 4: README Context
```markdown
# Content Factory

## Architecture
- Script generation: Gemini 2.5
- TTS: Gemini 2.5 TTS (not Edge-TTS!)
- Video: MoviePy
- Storage: Google Sheets

## Important Constraints
- Must work in GitHub Actions (no sudo!)
- No browser storage (client-side only)
- All API calls must be async

# –ê–≥–µ–Ω—Ç –ø–æ–Ω–∏–º–∞–µ—Ç:
# - –≠—Ç–æ Gemini, –Ω–µ OpenAI
# - –≠—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ Actions
# - –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sync –≤—ã–∑–æ–≤—ã
```

---

## üö´ –ö–ê–ö –ê–ì–ï–ù–¢ –ü–†–ï–î–û–¢–í–†–ê–©–ê–ï–¢ –û–ü–ê–°–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø?

### –ú–µ—Ö–∞–Ω–∏–∑–º 1: Dangerous Keywords (–ñ—ë—Å—Ç–∫–∏–π –æ—Ç–∫–∞–∑)

```python
dangerous_keywords = [
    'DROP TABLE',    # SQL –∏–Ω—ä–µ–∫—Ü–∏—è
    'DELETE FROM',   # –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    'rm -rf /',      # –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
    'chmod 777',     # –≠–∫—Å–ø–æ–∑–∏—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    'reboot',        # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ CI
    'sudo',          # –ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏
    'secret',        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤
    'password',      # ...
    'token',         # ...
    'export AWS',    # AWS —É—Ç–µ—á–∫–∞
]

# –ï—Å–ª–∏ –≤ –ª–æ–≥–∞—Ö/–∫–æ–¥–µ –≤–∏–¥–∏—Ç —ç—Ç–∏ —Å–ª–æ–≤–∞:
# –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –û–¢–ö–ê–ó
# –ê–≥–µ–Ω—Ç –ù–ï –±—É–¥–µ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å —Ñ–∏–∫—Å
# –¢–æ–ª—å–∫–æ –†–£–ß–ù–û–ô review!
```

**–ü—Ä–∏–º–µ—Ä:**
```
–õ–æ–≥: "ERROR: DROP TABLE users by mistake"
–§–∏–∫—Å? ‚ùå –û–¢–ö–ê–ó
–ò—Å—Ö–æ–¥: Issue + "MANUAL REVIEW REQUIRED"
```

### –ú–µ—Ö–∞–Ω–∏–∑–º 2: Caution Keywords (–¢—Ä–µ–±—É–µ—Ç —Å–∫–µ–ø—Å–∏—Å–∞)

```python
caution_keywords = [
    'database',    # –ù–µ–ª—å–∑—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å
    'migrate',     # –ú–∏–≥—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    'backup',      # –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–π
    'restore',     # –°–ª–∏—à–∫–æ–º –æ–ø–∞—Å–Ω–æ
    'config',      # –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
]

# –ï—Å–ª–∏ –≤–∏–¥–∏—Ç —ç—Ç–∏ —Å–ª–æ–≤–∞:
# - –¢—Ä–µ–±—É–µ—Ç min_confidence >= 0.9 (90%!)
# - –ü—Ä–æ—Å–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
# - –ú–æ–∂–µ—Ç –æ—Ç–∫–∞–∑–∞—Ç—å
```

**–ü—Ä–∏–º–µ—Ä:**
```
–õ–æ–≥: "ERROR: Database migration failed"
–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∞–≥–µ–Ω—Ç–∞: 75%
–£—Ö–æ–¥? ‚ùå –ù–ï–¢! (–Ω—É–∂–Ω–æ 90%+)
–ò—Å—Ö–æ–¥: Issue + Solution Steps –±–µ–∑ PR
```

### –ú–µ—Ö–∞–Ω–∏–∑–º 3: Side Effect Analysis (–ê–Ω–∞–ª–∏–∑ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤)

```python
# –ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º PR –∞–≥–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:

def check_side_effects(proposed_fix):
    # 1. –≠—Ç–æ—Ç —Ñ–∏–∫—Å –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç unrelated —Ñ–∞–π–ª—ã?
    if modifies_other_files(proposed_fix):
        return False  # –û—Ç–∫–∞–∑
    
    # 2. –í–≤–æ–¥–∏—Ç –∏–º–ø–æ—Ä—Ç –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π?
    if introduces_new_dependencies(proposed_fix):
        return False  # –û—Ç–∫–∞–∑
    
    # 3. –ò–∑–º–µ–Ω—è–µ—Ç API signature?
    if changes_public_api(proposed_fix):
        return False  # –û—Ç–∫–∞–∑
    
    # 4. –¢—Ä–µ–±—É–µ—Ç —è–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏?
    if requires_new_env_vars(proposed_fix):
        return False  # –û—Ç–∫–∞–∑
    
    # 5. –ú–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å –¥—Ä—É–≥–∏–µ —Ç–µ—Å—Ç—ã?
    if could_break_other_tests(proposed_fix):
        return False  # –û—Ç–∫–∞–∑
    
    return True  # OK, it's safe!
```

**–ü—Ä–∏–º–µ—Ä:**
```
–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π —Ñ–∏–∫—Å:
"Remove unused variable X from test file"

–ê–Ω–∞–ª–∏–∑:
‚úÖ –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ñ–∞–π–ª –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è
‚úÖ –ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚úÖ –ù–µ —Ç—Ä–æ–≥–∞–µ—Ç API
‚úÖ –ù–µ –Ω—É–∂–Ω—ã env vars
‚úÖ –ù–µ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å –¥—Ä—É–≥–∏–µ —Ç–µ—Å—Ç—ã

–í—ã–≤–æ–¥: ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–´–ô –§–ò–ö
```

### –ú–µ—Ö–∞–Ω–∏–∑–º 4: Confidence Score (–°–æ–º–Ω–µ–Ω–∏–µ = –û—Ç–∫–∞–∑)

```
min_confidence: 0.7  # 70%

–ï—Å–ª–∏ –∞–≥–µ–Ω—Ç < 70% —É–≤–µ—Ä–µ–Ω:
‚ùå –ù–µ —Å–æ–∑–¥–∞—ë—Ç PR
‚úÖ –°–æ–∑–¥–∞—ë—Ç Issue
‚úÖ –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç Solution Steps
üí¨ "Manual review required"
```

**–ü—Ä–∏–º–µ—Ä:**
```
–û—à–∏–±–∫–∞: "Module not found: foobar"
–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
1. –ó–∞–±—ã–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å (50%)
2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç (30%)
3. –ö–æ–Ω—Ñ–ª–∏–∫—Ç –≤–µ—Ä—Å–∏–π (15%)
4. –û—à–∏–±–∫–∞ –≤ PATH (5%)

–°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: 40%
–ê–∫—Ü–∏—è: ‚ùå –¢–æ–ª—å–∫–æ Issue, no PR
```

---

## üéØ –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ô –ü–†–ò–ú–ï–†: –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π: –ü–∞–¥–∞–µ—Ç —Ç–µ—Å—Ç —Å api_key

```
‚ùå FAILED: test_synthesize_shorts
   ValueError: Missing parameter 'api_key'
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç:

#### –®–∞–≥ 1: –ß–∏—Ç–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
```python
# –°–ª–æ–π 1: Project Config
Project type: "content-generator"
Python: 3.11 ‚úì

# –°–ª–æ–π 2: Recent Commits
abc123d: "Fix: Gemini TTS api_key parameter"
         "Added api_key to all synthesize() calls"

# –°–ª–æ–π 3: Test History
–ü—Ä–æ—à–ª—ã–µ 5 —Ç–µ—Å—Ç–æ–≤: 3x ‚úÖ, 2x ‚ùå

# –°–ª–æ–π 4: README
"TTS: Gemini 2.5 TTS (requires GOOGLE_AI_API_KEY)"
```

#### –®–∞–≥ 2: –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
```
–û—à–∏–±–∫–∞: Missing api_key parameter
–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
1. –ó–∞–±—ã–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä –ø—Ä–∏ –≤—ã–∑–æ–≤–µ (85%)
2. –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞ (10%)
3. –ß—Ç–æ-—Ç–æ —Å Environment vars (5%)

–ü–æ –∏—Å—Ç–æ—Ä–∏–∏: abc123d —É–∂–µ –ø—ã—Ç–∞–ª–∏—Å—å —Ñ–∏–∫—Å–∏—Ç—å
–í—ã–≤–æ–¥: –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —Ç–µ—Å—Ç –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω
–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: 85% ‚úÖ
```

#### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
```
–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π —Ñ–∏–∫—Å:
result = synthesize(config, script, mode, api_key=api_key)

–ü—Ä–æ–≤–µ—Ä–∫–∏:
‚úÖ –ù–µ –≤–∏–¥–∏—Ç dangerous keywords
‚úÖ –ù–µ –≤–∏–¥–∏—Ç caution keywords
‚úÖ Side effects: ZERO (—Ç–æ–ª—å–∫–æ test —Ñ–∞–π–ª)
‚úÖ Confidence: 85% >= 70% required

–í—ã–≤–æ–¥: –ë–ï–ó–û–ü–ê–°–ù–û!
```

#### –®–∞–≥ 4: –°–æ–∑–¥–∞—ë—Ç PR
```
üìù Issue: "api_key parameter missing in test"
üîß PR: Fix applied
üìù Description: "Tests were not updated after api_key parameter was added"
```

---

## ‚öôÔ∏è –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ö–û–ù–¢–†–û–õ–Ø

–í—Å—ë –≤ `.github/auto-fix-master-config.yml`:

```yaml
safety:
  dangerous_keywords: [...]  # –ñ—ë—Å—Ç–∫–∏–π –æ—Ç–∫–∞–∑
  caution_keywords: [...]    # –¢—Ä–µ–±—É–µ—Ç –º–∞–∫—Å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
  
context:
  include_project_config: true
  include_recent_commits: true
  include_test_history: true
  include_readme: true

auto_fix:
  min_confidence: 0.7  # 70% –º–∏–Ω–∏–º—É–º
```

**–•–æ—á–µ—à—å –º–µ–Ω–µ–µ —Å—Ç—Ä–æ–≥–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏?**
```yaml
auto_fix:
  min_confidence: 0.5  # 50% (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è!)
```

**–•–æ—á–µ—à—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–º?**
```yaml
auto_fix:
  min_confidence: 0.99  # 99% (–ø–æ —Å—É—Ç–∏, –æ—Ç–∫–ª—é—á–µ–Ω–æ)
```

---

## üõ°Ô∏è –ò–¢–û–ì: –ö–∞–∫ –∞–≥–µ–Ω—Ç –ù–ï –¥–µ–ª–∞–µ—Ç –≥–ª—É–ø–æ—Å—Ç–µ–π?

| –ü—Ä–æ–≤–µ—Ä–∫–∞ | –ú–µ—Ö–∞–Ω–∏–∑–º | –î–µ–π—Å—Ç–≤–∏–µ |
|----------|----------|----------|
| **Dangerous keywords** | Blacklist | ‚ùå –û—Ç–∫–∞–∑ |
| **Caution keywords** | Doubt | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç confidence |
| **Side effects** | Graph analysis | ‚ùå –û—Ç–∫–∞–∑ –µ—Å–ª–∏ –µ—Å—Ç—å |
| **Confidence score** | Statistical | ‚ùå –û—Ç–∫–∞–∑ –µ—Å–ª–∏ –Ω–∏–∑–∫–æ |
| **Context understanding** | ML analysis | ‚úÖ –õ—É—á—à–µ –ø–æ–Ω–∏–º–∞–µ—Ç |
| **Recent changes** | Git history | ‚úÖ –í–∏–¥–∏—Ç —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å |

---

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–≥–µ–Ω—Ç –û–ß–ï–ù–¨ –æ—Å—Ç–æ—Ä–æ–∂–µ–Ω –∏ –ù–ï –¥–µ–ª–∞–µ—Ç –æ–ø–∞—Å–Ω—ã—Ö –≤–µ—â–µ–π! üîí

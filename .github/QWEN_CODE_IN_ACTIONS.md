# Qwen Code CLI в GitHub Actions 🤖🚀

## ✅ Qwen Code ТЕ УСТАНОВЛЕН НА GITHUB!

Новый workflow: `.github/workflows/qwen-code-setup.yml`

Он будет:
1. Устанавливать Node.js 20
2. Принимать Qwen Code CLI
3. Настраивать окружение

---

## 💡 Как это работает

```
github.com (облако)
    ↓
    Setup Node.js 20
    ↓
    npm install -g @qwen-code/qwen-code
    ↓
    Qwen Code доступен
    ↓
    Используем в workflow'ах!
```

---

## 🚀 Тестировать

Открыть GitHub:
```
Actions → "Install Qwen Code CLI" → Run workflow
```

Посмотри логи - видишь:
```
🤖 Qwen Code установлен:
  @qwen-code/qwen-code: 0.0.11 (или новее)
📝 Настройки окружения:
  OPENAI_API_KEY: set ✅
  OPENAI_BASE_URL: https://dashscope.aliyuncs.com/compatible-mode/v1
  OPENAI_MODEL: qwen-max
```

Прекрасно! Qwen Code работает! ✅

---

## 📄 Основные команды

### 1. Анализ архитектуры:
```bash
echo "Describe the main pieces of this system's architecture" | qwen
```

### 2. Оптимизация кода:
```bash
echo "Refactor this function to improve readability and performance" | qwen
```

### 3. Генерация тестов:
```bash
echo "Generate unit tests for the authentication module" | qwen
```

### 4. Гит автомация:
```bash
echo "Create a changelog from recent commits" | qwen
```

### 5. Оптимизация workflow ошибок:
```bash
echo "Analyze this error and suggest a fix: [ERROR_TEXT]" | qwen
```

---

## 🏁 Пример workflow'a

### Вариант 1: Анализ всего репо
```yaml
name: Analyze with Qwen Code

on: [push]

jobs:
  analyze:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install Qwen Code
        run: npm install -g @qwen-code/qwen-code@latest
      
      - name: Analyze architecture
        env:
          OPENAI_API_KEY: ${{ secrets.QWEN_ACCESS_TOKEN }}
          OPENAI_BASE_URL: https://dashscope.aliyuncs.com/compatible-mode/v1
          OPENAI_MODEL: qwen-max
        run: |
          echo "Describe the main pieces of this system's architecture" | qwen
```

### Вариант 2: Оптимизация workflow failure
```yaml
name: Auto-Fix with Qwen Code

on:
  workflow_run:
    workflows: ["test"]
    types: [completed]
    
jobs:
  fix:
    if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install Qwen Code
        run: npm install -g @qwen-code/qwen-code@latest
      
      - name: Get failure logs
        id: logs
        run: |
          # Получи логи предыдущего workflow'a
          gh run view ${{ github.event.workflow_run.id }} --log > /tmp/logs.txt
        env:
          GH_TOKEN: ${{ github.token }}
      
      - name: Analyze and fix with Qwen
        env:
          OPENAI_API_KEY: ${{ secrets.QWEN_ACCESS_TOKEN }}
          OPENAI_BASE_URL: https://dashscope.aliyuncs.com/compatible-mode/v1
          OPENAI_MODEL: qwen-max
        run: |
          ERROR=$(cat /tmp/logs.txt | tail -50 | tr '\n' ' ')
          echo "Analyze this error and suggest a fix: $ERROR" | qwen
```

### Вариант 3: Генерация кода
```yaml
name: Generate with Qwen Code

on: [push]

jobs:
  generate:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install Qwen Code
        run: npm install -g @qwen-code/qwen-code@latest
      
      - name: Generate tests
        env:
          OPENAI_API_KEY: ${{ secrets.QWEN_ACCESS_TOKEN }}
          OPENAI_BASE_URL: https://dashscope.aliyuncs.com/compatible-mode/v1
          OPENAI_MODEL: qwen-max
        run: |
          echo "Generate comprehensive unit tests for all modules" | qwen
          
      - name: Generate documentation
        env:
          OPENAI_API_KEY: ${{ secrets.QWEN_ACCESS_TOKEN }}
          OPENAI_BASE_URL: https://dashscope.aliyuncs.com/compatible-mode/v1
          OPENAI_MODEL: qwen-max
        run: |
          echo "Generate JSDoc comments for all public APIs" | qwen
          
      - name: Commit if changes
        run: |
          git config user.name "Qwen Code"
          git config user.email "qwen-code@github.com"
          git add -A
          git commit -m "docs: auto-generated by Qwen Code" || true
          git push
```

---

## 🚨 Оставить выход

Так как Qwen Code интерактивный (Interactive mode):

Как сребать выход:

```bash
# Подставить комманду, потом перенаправить в файл:
echo "Analyze the main architecture" | qwen > /tmp/analysis.txt 2>&1 || true

# Обработать ответы:
cat /tmp/analysis.txt >> $GITHUB_STEP_SUMMARY

# Логировать:
echo "Analysis complete" | tee -a $GITHUB_STEP_SUMMARY
```

---

## ⚙️ Простая оптимизация

**Если явно не доработает**, можо:

1. Пропустить Qwen Code в Actions (non-blocking):
```yaml
- name: Try Qwen Code (optional)
  run: npm install -g @qwen-code/qwen-code@latest && echo "Analyze" | qwen
  continue-on-error: true  # Не останавливать, если ошибка
```

2. Аддитивные яргументы:
```bash
qwen --help  # Любые нюансы
```

---

## 🌟 Пример: Отоптимизированный Auto-Fix

```yaml
name: Optimized Auto-Fix with Qwen

on:
  workflow_run:
    workflows: ["test"]
    types: [completed]
    
jobs:
  analyze-and-fix:
    if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install Qwen Code & dependencies
        run: |
          npm install -g @qwen-code/qwen-code@latest
      
      - name: Get workflow logs
        id: logs
        run: |
          gh run view ${{ github.event.workflow_run.id }} --log 2>&1 | tail -100 > /tmp/error.log
        env:
          GH_TOKEN: ${{ github.token }}
        continue-on-error: true
      
      - name: Analyze with Qwen Code
        env:
          OPENAI_API_KEY: ${{ secrets.QWEN_ACCESS_TOKEN }}
          OPENAI_BASE_URL: https://dashscope.aliyuncs.com/compatible-mode/v1
          OPENAI_MODEL: qwen-max
        run: |
          echo "=== Analyzing failure ==="
          ERROR_TEXT=$(cat /tmp/error.log | head -30)
          echo "Error: $ERROR_TEXT"
          echo ""
          echo "Analyze this error and provide a concise fix suggestion:" | qwen
        continue-on-error: true
      
      - name: Summary
        run: |
          echo "## 🤖 Qwen Code Analysis Complete" >> $GITHUB_STEP_SUMMARY
          echo "Check logs above for suggestions" >> $GITHUB_STEP_SUMMARY
```

---

**ТЕПЕ РЬ Qwen Code ПОЛНОСТЬЮ НА GITHUB!** 🚀

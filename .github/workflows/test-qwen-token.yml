name: Test Qwen Token (Simple)

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Install Python deps
        run: pip install requests
      
      - name: Test Qwen Token
        env:
          QWEN_API_KEY: ${{ secrets.QWEN_REFRESH_TOKEN }}
        run: |
          python3 << 'EOF'
          import requests
          import os
          
          api_key = os.getenv('QWEN_API_KEY')
          print(f"API Key: {api_key[:10]}...")
          
          if not api_key:
              print("ERROR: API Key is empty!")
              exit(1)
          
          print("\nðŸ” Testing Qwen DashScope API with X-DashScope-ApiKey header...")
          
          # This is the correct way to use Qwen API
          response = requests.get(
              "https://dashscope.aliyuncs.com/api/v1/models",
              headers={
                  "X-DashScope-ApiKey": api_key,
                  "Content-Type": "application/json"
              }
          )
          
          print(f"Status Code: {response.status_code}")
          print(f"Response: {response.text[:500]}")
          
          if response.status_code == 200:
              print("\nâœ… SUCCESS! Qwen API works with this token!")
              exit(0)
          else:
              print(f"\nâŒ Failed with {response.status_code}")
              exit(1)
          EOF

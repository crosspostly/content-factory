name: üéØ Part 1 MVP Test

on:
  push:
    branches:
      - main
  workflow_dispatch:  # –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é
    inputs:
      mode:
        description: 'Generation mode'
        required: true
        default: 'shorts'
        type: choice
        options:
          - shorts
          - long_form
          - ad
      project:
        description: 'Project name'
        required: true
        default: 'youtube_horoscope'
      dry_run:
        description: 'Dry run (no upload)'
        required: true
        default: 'true'
        type: choice
        options:
          - 'true'
          - 'false'

jobs:
  test_part1:
    runs-on: ubuntu-latest
    name: Generate Content (Part 1 MVP)
    
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4
      
      - name: üêç Setup Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: üì¶ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt 2>/dev/null || echo "No requirements.txt, skipping"
      
      - name: üé¨ Generate Content
        run: |
          python -m core.orchestrators.pipeline_orchestrator \
            --project ${{ github.event.inputs.project || 'youtube_horoscope' }} \
            --mode ${{ github.event.inputs.mode || 'shorts' }} \
            ${{ github.event.inputs.dry_run == 'false' && '--upload' || '--dry-run' }}
        env:
          GOOGLE_AI_API_KEY: ${{ secrets.GOOGLE_AI_API_KEY }}
          OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}

      
      - name: üìä Check Output Artifacts
        if: always()
        run: |
          echo "üìÅ Generated Scripts:"
          find output/scripts -name "*.json" 2>/dev/null | head -5 || echo "No scripts generated"
          
          echo "\nüìÅ Generated Audio:"
          find output/audio -name "*.wav" 2>/dev/null | head -5 || echo "No audio generated"
          
          echo "\nüìÅ Generated Videos:"
          find output/videos -name "*.mp4" 2>/dev/null | head -5 || echo "No videos generated"
      
      - name: üì§ Upload Artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: content-factory-output
          path: |
            output/scripts/
            output/audio/
            output/videos/
            output/logs/
          retention-days: 7
      
      - name: ‚úÖ Success Notification
        if: success()
        run: echo "‚úÖ Part 1 MVP Test PASSED!"
      
      - name: ‚ùå Failure Notification
        if: failure()
        run: |
          echo "‚ùå Part 1 MVP Test FAILED!"
          echo "Check logs in Actions tab"
          exit 1


# ♾️ INFINITE PRAYER ENGINE (AUTO-GENERATOR)

> *"Сначала Архитектор строит план. Потом Писатель пишет книгу. Потом Диктор читает её по главам."*

Этот документ описывает обновленную систему версии 3.0, которая решает проблему 8-часовых видео через конвейерную обработку.

---

## 1. АЛГОРИТМ "CONVEYOR BELT"

Мы не пытаемся сгенерировать 8 часов сразу. Мы делаем это пошагово:

1.  **THE ARCHITECT (Архитектор):**
    *   Скрипт спрашивает тему у пользователя (в конфиге).
    *   Генерирует JSON-план из 20 глав.
    *   *Пример:* "Chapter 1: The Cleansing", "Chapter 2: The Filling", ...

2.  **THE WRITER (Сценарист):**
    *   Берет название главы.
    *   Пишет детальный сценарий на 1500 слов (около 10-12 минут речи).
    *   Использует гипнотические паттерны, повторения, "I AM" аффирмации.

3.  **THE SLICER (Нарезчик):**
    *   **Критический этап:** API Google Gemini (и любой другой TTS) не может озвучить 1500 слов за один раз. Он выдаст ошибку или обрежет аудио.
    *   Скрипт разбивает текст на предложения (по 600 символов).
    *   Это гарантирует, что каждое предложение будет озвучено качественно.

4.  **THE STITCHER (Сборщик):**
    *   Скрипт озвучивает каждый кусочек отдельно.
    *   Затем он берет бинарные данные WAV файлов, отрезает заголовки (Headers) и склеивает "тела" файлов в один огромный WAV файл для главы.
    *   Результат: бесшовное аудио на 15 минут.

---

## 2. ИНСТРУКЦИЯ ПО ЗАПУСКУ

### Шаг 1: Настройка
Откройте файл `scripts/marathon_worker.js` и отредактируйте `CONFIG`:

```javascript
const CONFIG = {
    THEME: "Financial Breakthrough & Abundance", // О чем будет видео
    TOTAL_CHAPTERS: 20,                          // Сколько частей (20 * 15мин = 5 часов)
    VOICE_MODEL: 'Charon',                       // Голос (Charon - лучший для медитаций)
    TTS_SAFE_CHUNK_SIZE: 600                     // Размер куска для TTS
};
```

### Шаг 2: Запуск Генератора
```bash
node scripts/marathon_worker.js
```
Скрипт создаст папку `output_marathon` и начнет наполнять её:
*   `PART_01.wav` (Аудио)
*   `PART_01.png` (Картинка)
*   `PART_01_script.txt` (Текст)

*Процесс займет время (около 10-15 минут на весь марафон), так как генерация аудио идет последовательно.*

### Шаг 3: Сборка в Видео (FFmpeg)
Когда скрипт закончит, используйте этот bash-скрипт (сохраните как `render.sh`) для склейки:

```bash
#!/bin/bash
# 1. Рендер сегментов (Loop Video + Audio)
for i in {01..20}; do
  echo "Rendering Part $i..."
  ffmpeg -y -loop 1 -i "output_marathon/PART_${i}.png" \
         -i "output_marathon/PART_${i}.wav" \
         -vf "scale=8000:-1,zoompan=z='min(zoom+0.0005,1.5)':d=700:x='iw/2-(iw/zoom/2)':y='ih/2-(ih/zoom/2)'" \
         -c:v libx264 -preset veryfast -tune stillimage \
         -c:a aac -b:a 192k \
         -shortest \
         "output_marathon/render_${i}.mp4"
done

# 2. Создание списка
ls output_marathon/render_*.mp4 | sed "s/^/file '/;s/$/'/" > concat_list.txt

# 3. Финальная склейка
ffmpeg -f concat -safe 0 -i concat_list.txt -c copy FINAL_MARATHON.mp4
```

---

## 3. СТРАТЕГИЯ КОНТЕНТА

Чтобы видео было "бесконечным", используйте темы, которые можно слушать фоном:
1.  **Biblical Sleep Affirmations:** Монотонное повторение псалмов.
2.  **I AM Decrees:** "Я есть свет, я есть сила..."
3.  **Healing Frequencies:** (Можно наложить фоном 432Hz музыку при монтаже в FFmpeg).

Система полностью автономна. Вы только задаете Тему.
